<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Understanding Encoding • kwb.fakin</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Understanding Encoding">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kwb.fakin</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development package">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analyse_scripts.html">Analysing R Scripts</a>
    </li>
    <li>
      <a href="../articles/understanding_encoding.html">Understanding Encoding</a>
    </li>
    <li>
      <a href="../articles/working_with_paths.html">Working with Paths</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kwb-r/kwb.fakin">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Understanding Encoding</h1>
                        <h4 class="author">Hauke Sonnenberg</h4>
            
            <h4 class="date">2018-07-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kwb-r/kwb.fakin/blob/master/vignettes/understanding_encoding.Rmd"><code>vignettes/understanding_encoding.Rmd</code></a></small>
      <div class="hidden name"><code>understanding_encoding.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In our document on best practices in research data managment we recommend to stick to a very basic set of characters when <a href="https://kwb-r.github.io/fakin.doc/best-practices.html#data-storage-naming">naming files and folders</a>.</p>
<p>You may ask, why? You may never have had any problems when working with files containing spaces or special characters. If this is the case for you, you are lucky. You then most probably</p>
<ul>
<li><p>do not exchange files between computers with different operating systems (i.e. Windows vs. Linux) and/or with different regional settings (e.g. German vs. English vs. French vs. Bulgarian),</p></li>
<li><p>do not automate tasks by programming.</p></li>
</ul>
</div>
<div id="example-sessions" class="section level2">
<h2 class="hasAnchor">
<a href="#example-sessions" class="anchor"></a>Example Sessions</h2>
<p>What does R tell us about Encoding?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?Encoding</code></pre></div>
<p>We learn, that R offers a function <code>Encoding()</code> as well as the functions <code>enc2native()</code> and <code>enc2utf8()</code>. How do these functions work?</p>
<p>Let’s have a look at the Examples given in the R documentation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## x is intended to be in latin1
x &lt;-<span class="st"> "fa</span><span class="ch">\xE7</span><span class="st">ile"</span>
<span class="kw">Encoding</span>(x)
<span class="co">#&gt; [1] "unknown"</span>
<span class="kw">Encoding</span>(x) &lt;-<span class="st"> "latin1"</span>
x
<span class="co">#&gt; [1] "façile"</span>
xx &lt;-<span class="st"> </span><span class="kw">iconv</span>(x, <span class="st">"latin1"</span>, <span class="st">"UTF-8"</span>)
<span class="kw">Encoding</span>(<span class="kw">c</span>(x, xx))
<span class="co">#&gt; [1] "latin1" "UTF-8"</span>
<span class="kw">c</span>(x, xx)
<span class="co">#&gt; [1] "façile" "façile"</span>
<span class="kw">Encoding</span>(xx) &lt;-<span class="st"> "bytes"</span>
xx <span class="co"># will be encoded in hex</span>
<span class="co">#&gt; [1] "fa\\xc3\\xa7ile"</span>
<span class="kw">cat</span>(<span class="st">"xx = "</span>, xx, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="dt">sep =</span> <span class="st">""</span>)
<span class="co">#&gt; xx = fa\xc3\xa7ile</span></code></pre></div>
</div>
<div id="writing-to-and-reading-from-files" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-to-and-reading-from-files" class="anchor"></a>Writing to and Reading from Files</h2>
<p>Lets write a line containing German special characters to a text file. We use the function <code>writeText()</code> from our <a href="https://github.com/kwb-r/kwb.utils">kwb.utils</a> package. This function does no more than using <code>writeLines()</code>, but additionally gives a message about it and returns the path to the file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> "Schöne Grüße"</span>

test_file &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">writeText</span>(text, <span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">".txt"</span>))
<span class="co">#&gt; Writing '/tmp/Rtmpfylqvr/file2c48375f0034.txt' ... ok.</span></code></pre></div>
<p>And now read the line back with <code>readLines()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readLines</span>(test_file)
<span class="co">#&gt; [1] "Schöne Grüße"</span></code></pre></div>
<p>Ok, no problem so far, because we used the same system to write and read the file.</p>
<p>Let’s have a look at the file byte-by-byte:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">con &lt;-<span class="st"> </span><span class="kw">file</span>(test_file, <span class="st">"r"</span>)

<span class="kw">sapply</span>(<span class="kw">seq_len</span>(<span class="kw">nchar</span>(text, <span class="st">"bytes"</span>)), <span class="cf">function</span>(i) {
  <span class="kw">readChar</span>(con, <span class="dv">1</span>, <span class="dt">useBytes =</span> <span class="ot">TRUE</span>)
})
<span class="co">#&gt;  [1] "S"    "c"    "h"    "\xc3" "\xb6" "n"    "e"    " "    "G"    "r"   </span>
<span class="co">#&gt; [11] "\xc3" "\xbc" "\xc3" "\x9f" "e"</span>

<span class="kw">close</span>(con)</code></pre></div>
<p>Wow, that is interesting. I did not know that! Standard characters are stored as one byte and only the special characters are stored as two bytes!</p>
<p>Now read the file again, this time as a vector of <code>raw</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(raw_bytes &lt;-<span class="st"> </span><span class="kw">readBin</span>(test_file, <span class="st">"raw"</span>, <span class="dv">100</span>))
<span class="co">#&gt;  [1] 53 63 68 c3 b6 6e 65 20 47 72 c3 bc c3 9f 65 0a</span></code></pre></div>
</div>
<div id="conversion-between-numeric-codes-and-characters" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion-between-numeric-codes-and-characters" class="anchor"></a>Conversion Between Numeric Codes and Characters</h2>
<p>What characters do the numeric codes given as hexedecimal numbers in <code>raw_bytes</code> represent?</p>
<p>Let’s first see what the hexanumeric codes are in the decimal system:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.integer</span>(raw_bytes)
<span class="co">#&gt;  [1]  83  99 104 195 182 110 101  32  71 114 195 188 195 159 101  10</span></code></pre></div>
<p>And now let’s convert the codes to characters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rawToChar</span>(raw_bytes)
<span class="co">#&gt; [1] "Schöne Grüße\n"</span></code></pre></div>
<p>The function <code>rawToChar()</code> seems to know how to interpret the sequence of byte codes.</p>
<p>Note that the last character (<code>10</code> in the decimal and <code>0a</code> in the hexadecimal system) represents the newline character <code>\n</code>.</p>
<p>What happens if I ask <code>rawToChar()</code> to convert the first and second byte representing the <code>ö</code> character separately?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rawToChar</span>(raw_bytes[<span class="dv">4</span>])
<span class="co">#&gt; [1] "\xc3"</span>
<span class="kw">rawToChar</span>(raw_bytes[<span class="dv">5</span>])
<span class="co">#&gt; [1] "\xb6"</span></code></pre></div>
<p>And now together:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rawToChar</span>(raw_bytes[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>])
<span class="co">#&gt; [1] "ö"</span></code></pre></div>
<p>There is an argument <code>multiple</code> to <code>rawToChar()</code>. It is <code>FALSE</code> by default. What happens if we set it to <code>TRUE</code>?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rawToChar</span>(raw_bytes[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>], <span class="dt">multiple =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] "\xc3" "\xb6"</span></code></pre></div>
<p>As the documentation says, setting <code>multiple</code> to <code>TRUE</code> returns the single characters instead of a single string.</p>
<p>How does this look if we convert the whole string?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(characters_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">rawToChar</span>(raw_bytes, <span class="dt">multiple =</span> <span class="ot">TRUE</span>))
<span class="co">#&gt;  [1] "S"    "c"    "h"    "\xc3" "\xb6" "n"    "e"    " "    "G"    "r"   </span>
<span class="co">#&gt; [11] "\xc3" "\xbc" "\xc3" "\x9f" "e"    "\n"</span></code></pre></div>
<p>Is this the same as splitting the original string into single characters?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">strsplit</span>(text, <span class="dt">split =</span> <span class="st">""</span>)[[<span class="dv">1</span>]]
<span class="co">#&gt;  [1] "S" "c" "h" "ö" "n" "e" " " "G" "r" "ü" "ß" "e"</span></code></pre></div>
<p>No, the German special characters are here shown as one character only instead of two. But we can achieve the same when setting the argument <code>useBytes</code> to <code>TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(characters_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">strsplit</span>(text, <span class="dt">split =</span> <span class="st">""</span>, <span class="dt">useBytes =</span> <span class="ot">TRUE</span>)[[<span class="dv">1</span>]])
<span class="co">#&gt;  [1] "S"    "c"    "h"    "\xc3" "\xb6" "n"    "e"    " "    "G"    "r"   </span>
<span class="co">#&gt; [11] "\xc3" "\xbc" "\xc3" "\x9f" "e"</span>

<span class="kw">identical</span>(characters_<span class="dv">1</span>[<span class="op">-</span><span class="kw">length</span>(characters_<span class="dv">1</span>)], characters_<span class="dv">2</span>)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div id="replace-special-characters-with-ascii-characters" class="section level1">
<h1 class="hasAnchor">
<a href="#replace-special-characters-with-ascii-characters" class="anchor"></a>Replace Special Characters with ASCII Characters</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">raw_bytes
<span class="co">#&gt;  [1] 53 63 68 c3 b6 6e 65 20 47 72 c3 bc c3 9f 65 0a</span>

<span class="kw">rawToChar</span>(raw_bytes)
<span class="co">#&gt; [1] "Schöne Grüße\n"</span>

<span class="kw">gsub</span>(<span class="st">"</span><span class="ch">\xc3\xb6</span><span class="st">"</span>, <span class="st">"oe"</span>, <span class="kw">rawToChar</span>(raw_bytes))
<span class="co">#&gt; [1] "Schoene Grüße\n"</span>
<span class="kw">gsub</span>(<span class="st">"</span><span class="ch">\xc3\xb6</span><span class="st">"</span>, <span class="st">"oe"</span>, <span class="kw">rawToChar</span>(raw_bytes), <span class="dt">useBytes =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] "Schoene Grüße\n"</span></code></pre></div>
<p>Ok, it seems that we can replace special characters if we know their byte codes (here: <code>c3</code> and <code>b6</code> for letter <code>ö</code>).</p>
<p>It will be helpful to have a function that shows the special characters and the corresponding byte codes</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kwb.fakin<span class="op">::</span><span class="kw">get_special_character_info</span>(text)
<span class="co">#&gt;   special bytes          context</span>
<span class="co">#&gt; 1    \xc3    c3 Sch [ ö ] ne Grü</span>
<span class="co">#&gt; 2    \xb6    b6  öne Gr [ ü ] ße</span>
<span class="co">#&gt; 3    \xc3    c3   ne Grü [ ß ] e</span>
<span class="co">#&gt; 4    \xbc    bc Sch [ ö ] ne Grü</span>
<span class="co">#&gt; 5    \xc3    c3  öne Gr [ ü ] ße</span>
<span class="co">#&gt; 6    \x9f    9f   ne Grü [ ß ] e</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#example-sessions">Example Sessions</a></li>
      <li><a href="#writing-to-and-reading-from-files">Writing to and Reading from Files</a></li>
      <li><a href="#conversion-between-numeric-codes-and-characters">Conversion Between Numeric Codes and Characters</a></li>
      <li><a href="#replace-special-characters-with-ascii-characters">Replace Special Characters with ASCII Characters</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hauke Sonnenberg.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
